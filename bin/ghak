#!/bin/bash

# ghak = git hub add key (public) 
# uses github api to add a public key to GH

function welcome () {
    echo "Welcome to the GitHub public key adder"
    echo -e "This will add a new public key to GH for you"
}

function help_me() {
    echo -e "Usage: ghak <username> <key name> <public key file>\n" 
}

function github_add_key() {
    local user dirty pubkey OPTIND=1

    arg_len=$#

    user=$1
    title=$2
    pubkey=$3

    if [[ $arg_len -lt 3 ]]; then
	      echo "Not enough arguments passed"
	      help_me
	      return
    fi

    curl -u "$user" -H "Accept: application/vnd.github.v3+json" https://api.github.com/user/keys -d '{"title":"'"$title"'", "key":"'"$(cat "$pubkey")"'"}'
}

github_add_key "$@"
